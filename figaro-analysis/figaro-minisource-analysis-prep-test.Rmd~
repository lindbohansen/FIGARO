---
title: "figaro-analysis-prep"
author: "Elisabeth Lindbo Hansen"
date: "`r date`"
output: html_document
params:
   inFullPath: ""
---

```{r setup, eval=TRUE, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stringr)
```

```{r in, eval=TRUE, include=TRUE}

fullPath=params$inFullPath
#fullPath="/home/elhansen/FIGARO/figaro-results/201700000000"
fileNames=dir(fullPath, recursive=TRUE, all.files=FALSE, full.names=TRUE, pattern =".csv")
outFile=str_c(fullPath,".csv")
data=tibble(iX=numeric(),iY=numeric(),iZ=numeric(),value=numeric())
temp=data
regexp1 <- '[[:digit:]]+cm.csv'
regexp2 <- '[[:digit:]]+'
regexp3 <- 'minisource-[[:digit:]].+/'
regexp4 <- '[[:digit:]]+..'
digit=0
source=0
for(i in 1:length(fileNames)){
  print(fileNames[i])
  temp=read_csv(fileNames[i],skip=3,col_names=c("iX","iY","iZ","value","value2","entry"))
  digit=str_extract(fileNames[i], regexp1)
  digit=str_extract(digit, regexp2)
  source=str_extract(fileNames[i],regexp3)
  source=str_extract_all(source,regexp4)
  temp$iZ=as.numeric(digit)
  temp=select(temp,iX,iY,iZ,value)
  temp=mutate(temp,sW=-as.numeric(source[[1]][1]))
  temp=mutate(temp,sH=-as.numeric(source[[1]][2]))
  temp=mutate(temp,sL=-as.numeric(source[[1]][3]))
  data=bind_rows(data,temp)
  #data=summarise(group_by(data,iX,iY,iZ,sW,sH,sL),value=sum(value))
}
data$iX=data$iX-max(data$iX)/2
write_csv(data,outFile)

#test=minisource-151.5-76.5-958.5
#regtest='[[:digit:]]+..'
#str_extract_all(test,regtest)


```
